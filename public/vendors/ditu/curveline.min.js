var BMapLib=window.BMapLib=BMapLib||{};!function(){function n(n,t){var r=e(n),i=new BMap.Polyline(r,t);return i.addEventListener("lineupdate",function(){this.isEditing&&this.enableEditing()}),i.cornerPoints=n,i.editMarkers=[],i.enableEditing=function(){var n=this;if(n.map){n.disableEditing();for(var t=0;t<n.cornerPoints.length;t++){var r=new BMap.Marker(n.cornerPoints[t],{icon:new BMap.Icon("http://api.map.baidu.com/library/CurveLine/1.5/src/circle.png",new BMap.Size(16,16)),enableDragging:!0,raiseOnDrag:!0});r.addEventListener("dragend",function(){n.cornerPoints.length=0;for(var t=0;t<n.editMarkers.length;t++)n.cornerPoints.push(n.editMarkers[t].getPosition());var r=e(n.cornerPoints);n.setPath(r)}),r.index=t,n.editMarkers.push(r),n.map.addOverlay(r)}}n.isEditing=!0},i.disableEditing=function(){this.isEditing=!1;for(var n=0;n<this.editMarkers.length;n++)this.map.removeOverlay(this.editMarkers[n]),this.editMarkers[n]=null;this.editMarkers.length=0},i.getPath=function(){return r},i}function e(n){for(var e=[],r=0;r<n.length-1;r++){var i=t(n[r],n[r+1]);i&&i.length>0&&(e=e.concat(i))}return e}function t(n,e){if(!(n&&e&&n instanceof BMap.Point&&e instanceof BMap.Point))return null;var t=function(n){return 1-2*n+n*n},r=function(n){return 2*n-2*n*n},i=function(n){return n*n};curveCoordinates=[];var a,o,s,d,u,l,c=0,p=0;if(void 0===e)return void("undefined"!=typeof curveCoordinates&&(curveCoordinates=[]));var h=parseFloat(n.lat),v=parseFloat(e.lat),M=parseFloat(n.lng),f=parseFloat(e.lng);for(f>M&&parseFloat(f-M)>180&&M<0&&(M=parseFloat(360+M)),M>f&&parseFloat(M-f)>180&&f<0&&(f=parseFloat(360+f)),0,l=0,v==h?(a=0,o=M-f):f==M?(a=Math.PI/2,o=h-v):(a=Math.atan((v-h)/(f-M)),o=(v-h)/Math.sin(a)),0==l&&(l=a+Math.PI/5),s=o/2,u=s*Math.cos(l)+M,d=s*Math.sin(l)+h,c=0;c<31;c++)curveCoordinates.push(new BMap.Point(M*t(p)+u*r(p)+f*i(p),h*t(p)+d*r(p)+v*i(p))),p+=1/30;return curveCoordinates}BMapLib.CurveLine=n}();